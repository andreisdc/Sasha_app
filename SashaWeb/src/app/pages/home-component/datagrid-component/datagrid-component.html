<nz-spin [nzSpinning]="loading">
  <div class="datagrid-container">
    @for(property of properties; track property.id) {
    <nz-card
      class="datagrid-card"
      (mouseenter)="hovered = property.id"
      (mouseleave)="hovered = null"
      [routerLink]="['/property', property.id]"
    >
      <div class="image-container">
        @if(property.images && property.images.length > 0) {
        <img
          [ngSrc]="property.images[currentIndex[property.id]]"
          alt="Property Image"
          class="property-image fade"
        />
        } @else{
        <ng-template #noImage>
          <div class="no-image-placeholder">No image available</div>
        </ng-template>
        }

        <p class="type"><b>{{property.type}}</b></p>
        <div class="arrows">
          @if(hovered===property.id) {
           <button class="prev" (click)="prev(property); $event.stopPropagation()">
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" stroke="white" fill="none" stroke-width="2">
               <path d="M15 18l-6-6 6-6"/>
             </svg>
            </button>

            <button class="next" (click)="next(property); $event.stopPropagation()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" stroke="white" fill="none" stroke-width="2">
                <path d="M9 6l6 6-6 6"/>
              </svg>
            </button>
          }
        </div>
        <p class="price">
          <b>{{ property.pricePerNight | currency:'EUR':'symbol':'1.0-0' }}</b>
        </p>
      </div>

      <div class="info">
        <h3 class="title">{{ property.name }}</h3>
        <button
          class="like-button"
          [class.liked]="property.liked"
          (click)="toggleLike(property)"
        >
          <i
            nz-icon
            nzType="heart"
            [nzTheme]="property.liked ? 'fill' : 'outline'"
          ></i>
        </button>
      </div>
    </nz-card>
  </div>

  <!-- Properties Grid -->
  <div *ngIf="!loading() && !error()" class="properties-grid">
    <!-- Header -->
    <div class="grid-header">
      <h2>Explore Properties</h2>
      <p class="subtitle">{{ totalProperties() }} properties available</p>
    </div>

    <!-- Properties Grid -->
    <div class="properties-cards">
      <div class="properties-grid-layout">
        <nz-card
          *ngFor="let property of paginatedProperties()"
          class="property-card"
          [nzHoverable]="true"
          (click)="navigateToProperty(property.id)"
        >
          <!-- Property Image -->
          <div class="property-image-container">
            <img
              [src]="property.images[0] || '/assets/images/placeholder-property.jpg'"
              [alt]="property.title || property.title"
              class="property-image"
            />
            
          </div>

          <!-- Property Content -->
          <div class="property-content">
            <div class="property-location">
              <span class="location-text">{{ property.city }}, {{ property.country }}</span>
              <nz-tag class="property-type-tag">
                <nz-icon [nzType]="getPropertyTypeIcon(property.propertyType)"></nz-icon>
                {{ getPropertyTypeLabel(property.propertyType) }}
              </nz-tag>
            </div>

            <h3 class="property-name">{{ property.title || property.title }}</h3>

            <div class="property-rating" *ngIf="property.averageRating > 0">
              <nz-rate 
                [ngModel]="property.averageRating" 
                nzDisabled 
                class="rating-stars"
              ></nz-rate>
              <span class="rating-value">{{ property.averageRating.toFixed(1) }} ({{ property.reviewCount }})</span>
            </div>

            <div class="property-rating" *ngIf="property.averageRating === 0">
              <span class="no-reviews">No reviews</span>
            </div>

            <div class="property-price">
              <span class="price-amount">{{ formatPrice(property.pricePerNight) }}</span>
              <span class="price-period">night</span>
            </div>
          </div>
        </nz-card>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalProperties() > pageSize()">
      <nz-pagination
        [nzPageIndex]="pageIndex()"
        [nzTotal]="totalProperties()"
        [nzPageSize]="pageSize()"
        (nzPageIndexChange)="onPageChange($event)"
        nzShowSizeChanger
        [nzPageSizeOptions]="[12, 24, 48, 96]"
      ></nz-pagination>
    </div>
  </div>
</div>